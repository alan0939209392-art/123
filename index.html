<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>速度單位換算器</title>
    
    <!-- PWA & Mobile Meta Tags for "Add to Home Screen" 讓App看起來像原生應用 -->
    <link rel="manifest" href="/manifest.json">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="速度換算">
    
    <!-- 載入 Tailwind CSS 進行響應式設計和美觀排版 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* 設定基本字體和背景 */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
    </style>
</head>
<body class="p-4 sm:p-8 min-h-screen flex items-start justify-center">

    <div id="app" class="w-full max-w-lg bg-white shadow-xl rounded-2xl p-6 sm:p-8 space-y-6">
        <h1 class="text-3xl font-bold text-gray-800 text-center border-b pb-4 mb-4">速度單位換算與時間計算</h1>
        <p class="text-center text-sm text-gray-500">將您輸入的速度值換算為米/秒，並計算行走指定距離所需的時間。</p>

        <!-- 速度輸入區塊 -->
        <div class="space-y-4">
            <label for="inputValue" class="block text-lg font-medium text-gray-700">輸入速度數值:</label>
            <input type="number" id="inputValue" value="100" min="0" step="any"
                   class="w-full p-3 border-2 border-indigo-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 text-2xl text-gray-800 transition duration-150 ease-in-out shadow-sm"
                   placeholder="請輸入速度值">
        </div>

        <!-- 單位選擇區塊 -->
        <div class="space-y-4">
            <label for="unitSelect" class="block text-lg font-medium text-gray-700">選擇速度單位:</label>
            <div class="relative">
                <select id="unitSelect"
                        class="block w-full appearance-none bg-white border-2 border-indigo-300 py-3 pl-4 pr-10 text-2xl rounded-lg focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 transition duration-150 ease-in-out shadow-sm">
                    <option value="kmh">公里/小時 (km/h)</option>
                    <option value="mph">英里/小時 (mph)</option>
                    <option value="ms">米/秒 (m/s)</option>
                    <option value="fts">英尺/秒 (ft/s)</option>
                    <option value="knots">海里/小時 (Knots)</option>
                </select>
                <!-- Custom Arrow for Select -->
                <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700">
                    <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/></svg>
                </div>
            </div>
        </div>
        
        <!-- 自訂目標距離輸入區塊 -->
        <div class="space-y-4 pt-4 border-t border-gray-100">
            <label for="targetDistanceInput" class="block text-lg font-medium text-gray-700">計算所需時間的目標距離 (公尺):</label>
            <input type="number" id="targetDistanceInput" value="100" min="1" step="any"
                   class="w-full p-3 border-2 border-green-300 rounded-lg focus:ring-green-500 focus:border-green-500 text-2xl text-gray-800 transition duration-150 ease-in-out shadow-sm"
                   placeholder="例如：100 公尺">
        </div>

        <!-- 主要結果顯示區塊 -->
        <div class="pt-6 border-t mt-6 border-indigo-200">
            <h2 class="text-xl font-semibold text-gray-700 mb-3">米/秒 (m/s) 換算結果</h2>
            <div id="resultDisplay" class="bg-indigo-100 p-4 sm:p-6 rounded-xl text-center shadow-inner">
                <p class="text-4xl font-extrabold text-indigo-700">
                    <span id="outputValue">0.00</span>
                    <span class="text-xl font-medium ml-1">m/s</span>
                </p>
            </div>
        </div>
        
        <!-- 時間計算結果區塊 -->
        <div class="pt-4 mt-4 border-t border-gray-200 space-y-4">
            <h2 class="text-xl font-semibold text-gray-700">計算結果 (時間)</h2>
            
            <!-- 自訂距離 / 幾秒 -->
            <div class="bg-blue-50 p-4 rounded-lg shadow-sm">
                <p class="text-lg text-gray-800">
                    物體行走 
                    <span id="targetDistanceSpan" class="text-green-600 font-bold text-2xl">100</span> 
                    公尺所需的時間為 
                    <span id="timeForTargetMeters" class="text-indigo-600 font-bold text-2xl">0.00</span> 
                    秒 (s)。
                </p>
            </div>
        </div>

        <!-- 錯誤訊息區塊 -->
        <p id="errorMsg" class="text-red-600 text-center hidden mt-4"></p>

    </div>

    <!-- 腳本區塊，包含 Firebase 初始化和計算邏輯 -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // 必須使用的全域變數 (用於沙箱環境的認證和資料庫設置)
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let app, auth, db;

        try {
            // 嘗試初始化 Firebase (為環境所需，本 App 不使用資料庫)
            if (Object.keys(firebaseConfig).length > 0) {
                app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);
                setLogLevel('Debug');
            }
        } catch (error) {
            console.error("Firebase 初始化失敗:", error);
        }

        // 單位換算核心邏輯
        
        // 換算因子：將各種單位轉換為米/秒 (m/s)
        const conversionFactors = {
            kmh: 1 / 3.6,           // 公里/小時
            mph: 0.44704,           // 英里/小時
            ms: 1,                  // 米/秒
            fts: 0.3048,            // 英尺/秒
            knots: 1852 / 3600      // 海里/小時
        };

        // 獲取 DOM 元素
        const inputValue = document.getElementById('inputValue');
        const unitSelect = document.getElementById('unitSelect');
        const targetDistanceInput = document.getElementById('targetDistanceInput');
        
        const outputValueSpan = document.getElementById('outputValue');
        const timeForTargetMetersSpan = document.getElementById('timeForTargetMeters');
        const targetDistanceSpan = document.getElementById('targetDistanceSpan');
        const errorMsg = document.getElementById('errorMsg');

        /**
         * 執行速度換算和時間計算
         */
        function convertSpeed() {
            const value = parseFloat(inputValue.value);
            const unit = unitSelect.value;
            const targetDistance = parseFloat(targetDistanceInput.value);
            
            // 清除錯誤訊息
            errorMsg.classList.add('hidden');
            
            // 設置預設值和更新目標距離顯示
            outputValueSpan.textContent = "0.00";
            timeForTargetMetersSpan.textContent = "0.00";
            targetDistanceSpan.textContent = targetDistanceInput.value.trim() || "0";

            // 檢查速度輸入值 (必須是非負數)
            if (isNaN(value) || value < 0) {
                if (inputValue.value.trim() !== "") { 
                    errorMsg.textContent = "請輸入有效的非負速度值。";
                    errorMsg.classList.remove('hidden');
                }
                return;
            }
            
            // 檢查目標距離輸入值 (必須是正數)
            if (isNaN(targetDistance) || targetDistance <= 0) {
                if (targetDistanceInput.value.trim() !== "") {
                     errorMsg.textContent = "請輸入有效的正數目標距離 (公尺)。";
                    errorMsg.classList.remove('hidden');
                }
                // 如果距離無效，仍顯示使用者輸入的內容，但時間結果為 0.00
                targetDistanceSpan.textContent = targetDistanceInput.value.trim() || "0";
                return;
            }


            const factor = conversionFactors[unit];
            let speedMs = 0; // 換算後的米/秒速度

            if (factor !== undefined) {
                speedMs = value * factor;
                
                // 1. 主要結果：米/秒 (m/s)，保留四位小數
                outputValueSpan.textContent = speedMs.toFixed(4);
                
                // 2. 行走自訂目標距離所需的時間
                if (speedMs > 0) {
                    // 時間 = 距離 / 速度
                    const timeForTarget = targetDistance / speedMs;
                    timeForTargetMetersSpan.textContent = timeForTarget.toFixed(2); // 保留兩位小數
                } else {
                    // 速度為零時，所需時間為無限
                    timeForTargetMetersSpan.textContent = "∞";
                }
                
            } else {
                errorMsg.textContent = "無效的單位選擇。";
                errorMsg.classList.remove('hidden');
            }
        }

        // 監聽所有輸入框和下拉選單的變動，實現即時計算
        inputValue.addEventListener('input', convertSpeed);
        unitSelect.addEventListener('change', convertSpeed);
        targetDistanceInput.addEventListener('input', convertSpeed);

        // 應用程式啟動時執行一次換算，以顯示初始值
        window.onload = convertSpeed;

    </script>
</body>
</html>
